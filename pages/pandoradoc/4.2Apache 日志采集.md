在 nginx 日志分析搭建案例中大家已经明白如何快速搭建实时监控与报警平台的整个过程。除了 nginx 之外，apache(httpd) 服务也是现代 web 服务栈中重要的组件之一，本文档作为一个补充，介绍通过 logkit Pro 来收集 apache 的 access.log，数据进入到日志分析平台以后的监控过程与 nginx 日志分析的案例相同，请参考[nginx 日志分析](/insight/manual/4612/nginx-scene)，本文档就不再赘述。

<a href="#1">1.下载并启动 logkit Pro</a>

<a href="#2">2.使用 logkit Pro 收集日志</a>

-----


<a name="1"></a>

# **1.下载并运行 logkit Pro **

根据您机器的操作系统版本下载 logkit Pro，logkit Pro 下载地址请阅读 [logkit 安装](/insight/manual/4682/logkit-pro-install#1) 。

解压后您可以看到：

![](https://pandora-kibana.qiniu.com/logkitPro/conf.png)

其中 ```logkit.conf``` 为主配置文件，用于配置 logkit Pro 的 web 页面及端口配置，其中

* ```bind_host``` 是设置绑定的端口，启动后可以根据这个配置打开 logkit Pro web 页面，默认的端口为 `3000`。

![](https://pandora-kibana.qiniu.com/logkitPro/apache_conf.png)

命令行进入 logkit Pro 所在文件夹，输入如下命令启动 logkit Pro：

```./logkit-pro -f logkit-pro.conf```

通过浏览器访问 logkit Pro:

http://127.0.0.1:3000

![logkit首页](https://odum9helk.qnssl.com/FoPsWnVSjGJ3FzyigTDVAoq60MoF)

本地登录 logkit Pro:

在 logkit Pro 首页右上角，点击`登录`。

![本地登录](https://pandora-kibana.qiniu.com/quickstart/login.png)

本地登录的默认用户名和密码都是 admin。

-----

<a name="2"></a>

# **2.使用 logkit Pro 收集日志**

进入数据收集页面，点击**添加收集器**开始配置收集器。

![](https://pandora-kibana.qiniu.com/quickstart/logkit_collect.png)

## **添加数据源**

一般情况下，您的日志是跟 nginx 日志一样写入同一个文件的话，就选择 file 模式，file 模式会不断读取文件尾追加的数据。

![](https://pandora-kibana.qiniu.com/access.png)

## **数据解析**

配置好数据来源以后，就开始配置数据解析方式，我们使用 grok 表达式解析 Apache 日志，logkit Pro 提供了一些默认表达式的支持，其中``` %{COMMON_LOG_FORMAT}``` 就可以解析 Apache 日志。

对于 grok 表达式，玩过 ELK 的用户不会陌生，我们完全支持 logstash 的 grok 表达式，对于自己配置的一些特殊 Apache 日志，可以访问我们的 wiki 页面了解进阶用法: 学习如何调试您的 grok 表达式 [如何调试您的grok-patterngrokdebug用法](/insight/manual/4759/Grok Parser).

配置好后，点击解析样例数据，查看解析是否成功。

![](https://pandora-kibana.qiniu.com/apache_grok.png)

## **数据转换**

这一步可以做一些更精细的字段解析。在这里，我们跳过这一步，直接点击下一步。

## **数据发送**

将数据发送至日志分析平台，填写日志分析仓库名称、您七牛账户的 AK、SK 即可。

同时需要填写工作流名称与数据源名称，将日志发送到工作流平台，方便在工作流平台对数据进行计算。

![](https://pandora-kibana.qiniu.com/logkitPro/apache_send.png)

## **确认收集**

最后，填写收集器名称确认添加数据收集器就大功告成啦！

![](https://pandora-kibana.qiniu.com/logkitPro/apache_confirm.png)

