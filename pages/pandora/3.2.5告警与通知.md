

报警功能帮您监控日志数据。您只需要设置好报警指标、报警阈值等，当满足触发条件时，通过 `HTTP 接口回调`、`邮件提醒`、`短信提醒`这三种方式，系统会给您发送报警相关信息，提醒您日志哪里出现了异常。

#### **配置报警**

单击搜索栏下面的“另存为告警”，开始配置报警项。

在报警设置页面，您需要填写以下信息：

![](https://pandora-kibana.qiniu.com/warn_setting_new.png)

这是一条名称是“响应时间平均数大于 1 秒报警“的报警配置，它的意思是：每隔 1 分钟检测最近 10 分钟内的日志内容，request_time 这个字段的平均值如果超过 1 就触发报警，且 15 分钟内即使满足报警条件也只触发一次报警。

**运行周期**

您可以设置每隔多久检测一次日志内容报警。

**查询时间**
 
 设定一个查询的时间范围，只针对这个时间范围内的日志检测报警。
 
**分组字段 报警指标 报警阈值**

您可以通过这三条信息创建报警触发条件，其中您可以通过分组字段对数据进行分组，对每个分组的数据分别监控报警指标。通过自由组合，您可以创建以下两种报警触发条件：

1.按事件总数报警

报警指标选择事件总数，给定一个触发报警的阈值。例如，您可以设置报警条件为 10 分钟内根据 machine 分组的日志事件总数超过 100：

![](https://pandora-kibana.qiniu.com/warn06.png)

2.按字段统计数报警

在报警指标里选择统计方式（总和、平均值、最大值、最小值、中位数、分位数），紧跟其后选择字段名，例如，告警触发条件为：根据 machine 字段分组的日志数据里，request_time 在 10 分钟之内的平均值大于 1:

![](https://pandora-kibana.qiniu.com/warn07.png)

**报警限制** 

防止您在短时间内遭遇报警轰炸，您可以设置一个固定时间段，在该时间段内出发告警后，系统不再重复发送同类告警信息。

**报警类型**

* logdb 支持 HTTP 接口回调报警方式，添加能接受请求的地址，logdb 会发送告警内容到该地址，提醒您日志哪里出现了异常。同时可以在HTTP请求中增加自定义的 Header，用来完成例如鉴权等多种高级需求。请求方式为 HTTP POST 请求，请求体格式如下：

```
{
	"alert": "alert",  // alert 名字
	"time": "2018-03-06 14:15:52",  // 报警时间
	"metrics": [{
		"buckets": { // 每个分组的详细信息
			"groupId": "分组1"  // groupId 字段为 分组1 
		},
		"value": 137543.0, // 分组的统计值
		"abnormal": true   // 是否出现异常，true为异常，false为正常
	}, {
		"buckets": {
			"groupId": "分组2"
		},
		"value": 69610.0,
		"abnormal": true
	}]
}
```

* 邮件报警：支持发送邮件到指定多个邮箱内进行报警。邮件包含了报警的异常信息，以及可能的相关日志。

![](https://pandora-kibana.qiniu.com/email-alert.png)


* 短信报警：短信报警可以指将报警时的简略信息发送到用户手机上，随时随地掌握系统健康状况。

```
尊敬的七牛云用户，您的日志服务名称：metrictype 分组处理数据报警
（描述：统计每个 metrictype 分组，正在处理的数据总量）出现异常。
metrictype 分组含有 3 个异常分组，例如分组值为 http 的当前指标
【sum(success)】值为 386.0 小于等于报警阈值【3000.0】。
详情敬请登录七牛云查看。【七牛云服务】
```


**测试**

填好配置项以后，您可以点击测试规则测试一下报警设置是否生效。

![](https://pandora-kibana.qiniu.com/warn_test.png)

> 注意：每个账号暂时最多只支持创建 5 条报警。如果需要额外创建报警，请与管理员联系。

都设置好以后，您就可以让 logdb 帮您监控数据啦！

